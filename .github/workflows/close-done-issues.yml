# This is workflow checks a given project board every 5th minute and closes all of the issues in the 'done' column.

name: close-done-issues

# Controls when the workflow will run
on: 
  push:
  # schedule: # Workflow will run every 5th minute. 
  #   - cron: "*/5 * * * *"
  # # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:


env:
  TARGET_PROJECT: TestBacklog


# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  close-done-issues:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Get Project Data
        env: 
          GITHUB_TOKEN: ${{ secrets.PROJECT_ISSUE_CLOSING_PAT }}
          OWNER: ${{ github.repository_owner }}
          PROJECT_NUMBER: 1
        run: |
          projects="$(gh api graphql -f org=$OWNER -F number=$PROJECT_NUMBER -f query='
            query($org: String! $number: Int!) {
              organization(login: $org) {
                projectNext(number: $number) {
                  id
                }
              }
            }
          ')"

          echo 'Projects='$projects


